<?xml version="1.0"?>
<define>
  <!-- Constant defining the clearance between volumes -->
  <constant name="clearance" value="0.001*mm"/>
  <!-- Dimensions of world volume -->
  <constant name="world_dim" value="12.0*m"/>
  <constant name="world_x" value="world_dim"/>
  <constant name="world_y" value="world_dim"/>
  <constant name="world_z" value="world_dim"/>
  <!-- 
  Detector ID's 
    These are the subdetector ID's assigned within ldmx-sw. They can be found 
    at ldmx-sw/DetDescr/include/DetDescr/DetectorID.h
  -->
  <constant name="null_id" value="0"/>
  <constant name="tagger_tracker_id" value="1"/>
  <constant name="trigger_scint_id" value="2"/>
  <constant name="active_target_id" value="3"/>
  <constant name="recoil_tracker_id" value="4"/>
  <constant name="ecal_id" value="5"/>
  <constant name="hcal_id" value="6"/>
  <constant name="sim_special_id" value="7"/>
  <!-- 
        Target
  -->
  <!-- position -->
  <constant name="target_z" value="0.0*mm"/>
  <!-- Tungsten X0 = .3504 cm.  Target thickeness = .1X0 -->
  <constant name="target_thickness" value="0.3504*mm"/>
  <!-- Target dimensions -->
  <constant name="target_dim_x" value="4.0*cm"/>
  <constant name="target_dim_y" value="10.0*cm"/>
  <constant name="target_area_env_x" value="magnet_gap_x - 5" />
  <constant name="target_area_env_y" value="magnet_gap_y - 5" />
  <constant name="target_area_env_z" value="2*(target_thickness/2 + 2*clearance + trigger_scint_thickness)" />
  
  <!-- 
        Magnet gap dimensions 
  -->
  <constant name="magnet_gap_x" value="430*mm"/>
  <constant name="magnet_gap_y" value="350*mm"/>
  <!--
        Trigger Scintillator 
  -->
  <!-- Trigger scintillator positions -->
  <constant name="trigger_scint_thickness" value="4.5*mm"/>
  <!-- Trigger scint midpoint distance from the target is -2.4262 mm -->
  <constant name="trigger_scint_up_mid_z" value="target_z - (target_thickness/2) - (trigger_scint_thickness/2) - clearance"/>
  <constant name="trigger_scint_down_mid_z" value="target_z + (target_thickness/2) + (trigger_scint_thickness/2) + clearance"/>
  <!--
        Trackers 
  -->
  <!-- sensor dimensions -->
  <constant name="tracker_sensor_x" value="38.3399*mm"/>
  <constant name="tracker_sensor_y" value="98.33*mm"/>
  <constant name="recoil_l56_sensor_x" value="48*mm"/>
  <constant name="recoil_l56_sensor_y" value="78*mm"/>
  <constant name="tracker_sensor_thickness" value="0.32*mm"/>
  <constant name="carbon_fiber_thickness" value="0.2*mm"/>
  <!-- Stereo Angle = 100 mrad = 5.72 degrees -->
  <constant name="stereo_angle" value="5.72957795130823*deg"/>
  <!--
        Tagger Tracker 
  -->
  <!-- layer X positions assuming a 1.5 T field. -->
  <constant name="tagger_l1_x" value="-20.955*mm"/>
  <constant name="tagger_l2_x" value="-14.643*mm"/>
  <constant name="tagger_l3_x" value="-9.461*mm"/>
  <constant name="tagger_l4_x" value="-5.407*mm"/>
  <constant name="tagger_l5_x" value="-2.481*mm"/>
  <constant name="tagger_l6_x" value="-0.681*mm"/>
  <constant name="tagger_l7_x" value="-0.006*mm"/>
  <!-- offset in Z between stereo sensors -->
  <constant name="tagger_layer_offset" value="3.0*mm"/>
  <!-- 
      Tagger tracker distances relative to envelope volume face closest to 
      target.
  -->
  <!-- 
        20 cm between recoil l1 mid and tagger l7 mid
        Distance from target to mid point of a module. 
        Layer 7: 10 mm
        Layer 6: 110 mm
        Layer 5: 210 mm
        Layer 4: 310 mm
        Layer 3: 410 mm
        Layer 2: 510 mm
        Layer 1: 610 mm
  -->
  <constant name="tagger_delta_layer" value="100*mm"/>
  <constant name="tagger_l7_mid_z" value="5.5*mm - target_thickness/2 - 2*clearance"/>
  <constant name="tagger_l6_mid_z" value="tagger_l7_mid_z + tagger_delta_layer"/>
  <constant name="tagger_l5_mid_z" value="tagger_l6_mid_z + tagger_delta_layer"/>
  <constant name="tagger_l4_mid_z" value="tagger_l5_mid_z + tagger_delta_layer"/>
  <constant name="tagger_l3_mid_z" value="tagger_l4_mid_z + tagger_delta_layer"/>
  <constant name="tagger_l2_mid_z" value="tagger_l3_mid_z + tagger_delta_layer"/>
  <constant name="tagger_l1_mid_z" value="tagger_l2_mid_z + tagger_delta_layer"/>
  <!-- Dimensions of the tagger tracker envelope -->
  <constant name="tagger_env_x" value="magnet_gap_x - 5*mm"/>
  <constant name="tagger_env_y" value="magnet_gap_y - 5*mm"/>
  <!-- 608.3228 mm -->
  <constant name="tagger_env_z" value="tagger_l1_mid_z + tagger_layer_offset"/>
  <!-- Midpoint of tagger envelope in world volume -->
  <constant name="tagger_env_pos_z" value="trigger_scint_up_mid_z - trigger_scint_thickness/2 - tagger_env_z/2 - clearance"/>
  <!-- Position of the tagger envelope face closest to the target -->
  <constant name="tagger_z_start" value="tagger_env_z/2"/>
  <!-- position of each layer in local coordinates of envelope volume -->
  <constant name="tagger_l1_env_mid_z" value="tagger_z_start - tagger_l1_mid_z"/>
  <constant name="tagger_l2_env_mid_z" value="tagger_z_start - tagger_l2_mid_z"/>
  <constant name="tagger_l3_env_mid_z" value="tagger_z_start - tagger_l3_mid_z"/>
  <constant name="tagger_l4_env_mid_z" value="tagger_z_start - tagger_l4_mid_z"/>
  <constant name="tagger_l5_env_mid_z" value="tagger_z_start - tagger_l5_mid_z"/>
  <constant name="tagger_l6_env_mid_z" value="tagger_z_start - tagger_l6_mid_z"/>
  <constant name="tagger_l7_env_mid_z" value="tagger_z_start - tagger_l7_mid_z"/>
  <!-- 
        Recoil tracker parent volume dimensions. In x/y, these are set 5 mm
        smaller than the magnet gap defined in magnet.gdml in order to avoid
        overlaps. The magnet gaps were extracted from the drawing of the magnet
        obtained from JLab.
  -->
  <constant name="recoil_env_x" value="magnet_gap_x - 5*mm"/>
  <constant name="recoil_env_y" value="magnet_gap_y - 5*mm"/>
  <constant name="recoil_env_z" value="200*mm"/>
  <!-- Offset between layers within a half-module -->
  <constant name="recoil_layer_l14_offset" value="3.0*mm"/>
  <constant name="recoil_layer_l56_offset" value="1.0*mm"/>
  <constant name="recoil_env_pos_z" value="trigger_scint_down_mid_z + trigger_scint_thickness/2 + recoil_env_z/2 + clearance"/>
  <!-- Recoil tracker z positions relative to the parent volume -->
  <!-- Layer distance from target: 
    1: 7 mm
    2: 13 mm
    3: 22 mm
    4: 28 mm
    5: 37 mm
    6: 43 mm
    7: 52 mm
    8: 58 mm
    9: 92 mm
   10: 182 mm
  -->
  <constant name="recoil_delta_l1_l4" value="15*mm"/>
  <constant name="recoil_delta_l4_l5" value="37*mm"/>
  <constant name="recoil_delta_l5_l6" value="90*mm"/>
  <constant name="recoil_l1_mid_z" value="5.5*mm   - target_thickness/2 - 2*clearance"/>
  <constant name="recoil_l2_mid_z" value="recoil_l1_mid_z + recoil_delta_l1_l4"/>
  <constant name="recoil_l3_mid_z" value="recoil_l2_mid_z + recoil_delta_l1_l4"/>
  <constant name="recoil_l4_mid_z" value="recoil_l3_mid_z + recoil_delta_l1_l4"/>
  <constant name="recoil_l5_mid_z" value="recoil_l4_mid_z + recoil_delta_l4_l5"/>
  <constant name="recoil_l6_mid_z" value="recoil_l5_mid_z + recoil_delta_l5_l6"/>
  <!-- layering start position in envelope volume -->
  <constant name="recoil_z_start" value="-recoil_env_z/2"/>
  <!-- position of each layer in local coordinates of envelope volume -->
  <constant name="recoil_l1_env_mid_z" value="recoil_z_start + recoil_l1_mid_z"/>
  <constant name="recoil_l2_env_mid_z" value="recoil_z_start + recoil_l2_mid_z"/>
  <constant name="recoil_l3_env_mid_z" value="recoil_z_start + recoil_l3_mid_z"/>
  <constant name="recoil_l4_env_mid_z" value="recoil_z_start + recoil_l4_mid_z"/>
  <constant name="recoil_l5_env_mid_z" value="recoil_z_start + recoil_l5_mid_z"/>
  <constant name="recoil_l6_env_mid_z" value="recoil_z_start + recoil_l6_mid_z"/>
</define>
